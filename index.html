<!DOCTYPE html>
<html lang="hr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>Turistički informator Valpovo</title>

<style>
*{
    box-sizing:border-box;
}

body{
    margin:0;
    font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;
    background:#eef2f7;
    display:flex;
    flex-direction:column;
    height:100vh;
}

header{
    background:linear-gradient(135deg,#2f5597,#3f6fb6);
    color:white;
    padding:16px 20px;
    display:flex;
    align-items:center;
    gap:15px;
    flex-shrink:0;
}

header img{
    height:40px;
}

header h2{
    margin:0;
    font-size:18px;
}

#chat{
    flex:1;
    overflow-y:auto;
    padding:20px;
    display:flex;
    flex-direction:column;
    gap:18px;
}

.message{
    display:flex;
    gap:10px;
    align-items:flex-start;
}

.avatar{
    width:32px;
    height:32px;
    border-radius:50%;
    background:#2f5597;
    color:white;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:12px;
    flex-shrink:0;
}

.bubble{
    background:white;
    padding:16px;
    border-radius:12px;
    box-shadow:0 3px 10px rgba(0,0,0,0.08);
    max-width:100%;
    word-wrap:break-word;
}

.quickButtons{
    margin-top:14px;
    display:flex;
    flex-wrap:wrap;
    gap:8px;
}

.quickButtons button{
    background:#e1e8f6;
    border:none;
    padding:6px 12px;
    border-radius:18px;
    font-size:12px;
    cursor:pointer;
}

#inputArea{
    background:white;
    padding:12px 15px;
    border-top:1px solid #ddd;
    display:flex;
    gap:8px;
    flex-shrink:0;
}

#input{
    flex:1;
    padding:10px;
    border-radius:6px;
    border:1px solid #ccc;
    font-size:14px;
}

#send{
    padding:10px 16px;
    background:#2f5597;
    color:white;
    border:none;
    border-radius:6px;
    font-size:14px;
    cursor:pointer;
}

footer{
    display:none;
}

/* Desktop optimizacija */

@media (min-width:768px){

    header{
        padding:22px 40px;
    }

    header img{
        height:60px;
    }

    header h2{
        font-size:22px;
    }

    #chat{
        padding:40px 60px;
        gap:28px;
    }

    .bubble{
        max-width:800px;
        padding:22px;
    }

    #inputArea{
        padding:18px 40px;
    }

    footer{
        display:block;
        text-align:center;
        font-size:13px;
        padding:10px;
        background:#f4f6fa;
    }
}

</style>
</head>

<body>

<header>
<img src="tz-logo-Valpovo.png">
<h2>Turistički informator – Valpovo</h2>
</header>

<div id="chat">
<div class="message">
<div class="avatar">AI</div>
<div class="bubble">
<strong>Dobrodošli!</strong><br><br>
Kako vam mogu pomoći?

<div class="quickButtons">
<button onclick="quickAsk('Što vrijedi vidjeti u Valpovu?')">Znamenitosti</button>
<button onclick="quickAsk('Gdje mogu jesti u Valpovu?')">Gastronomija</button>
<button onclick="quickAsk('Koja su aktualna događanja?')">Događanja</button>
<button onclick="quickAsk('Gdje mogu prespavati?')">Smještaj</button>
<button onclick="quickAsk('Gdje prošetati?')">Priroda</button>
</div>

</div>
</div>
</div>

<div id="inputArea">
<input id="input" placeholder="Postavite pitanje...">
<button id="send">Pošalji</button>
</div>

<footer>
© Turistička zajednica grada Valpova
</footer>

<script>

document.addEventListener("DOMContentLoaded", function(){

    const chat = document.getElementById("chat");
    const input = document.getElementById("input");
    const sendBtn = document.getElementById("send");

    function scrollToBottom(){
        chat.scrollTop = chat.scrollHeight;
    }

    function addMessage(text, role="ai"){

        const wrapper = document.createElement("div");
        wrapper.className="message";

        wrapper.innerHTML = `
            <div class="avatar">${role === "user" ? "Vi" : "AI"}</div>
            <div class="bubble">${text}</div>
        `;

        chat.appendChild(wrapper);
        scrollToBottom();
    }

    async function sendMessage(){

        const message = input.value.trim();
        if(message === "") return;

        addMessage(message, "user");

        const thinking = document.createElement("div");
        thinking.className="message";
        thinking.innerHTML = `
            <div class="avatar">AI</div>
            <div class="bubble"><em>Razmišljam...</em></div>
        `;
        chat.appendChild(thinking);
        scrollToBottom();

        try{

            const response = await fetch("/api/chat", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ message })
            });

            const data = await response.json();
            chat.removeChild(thinking);

            if(data.recommendations){
                let html = `<h3>${data.title}</h3><p>${data.intro}</p><ul>`;
                data.recommendations.forEach(r=>{
                    html += `<li><strong>${r.name}</strong><br>${r.reason}</li>`;
                });
                html += `</ul><p><em>${data.followUpQuestion}</em></p>`;
                addMessage(html);
            } else {
                addMessage("Trenutno nemam dovoljno podataka za taj upit.");
            }

        } catch(error){
            chat.removeChild(thinking);
            addMessage("Došlo je do tehničke pogreške.");
        }

        input.value="";
    }

    sendBtn.addEventListener("click", sendMessage);
    input.addEventListener("keypress", function(e){
        if(e.key === "Enter"){
            sendMessage();
        }
    });

    window.quickAsk = function(text){
        input.value = text;
        sendMessage();
    }

    scrollToBottom();

});

</script>

</body>
</html>
