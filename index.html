<!DOCTYPE html>
<html lang="hr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Turistički informator</title>

<style>
*{box-sizing:border-box;}
body{
margin:0;
font-family:Arial, sans-serif;
background:#eef2f7;
display:flex;
flex-direction:column;
height:100vh;
}
header{
background:#2f5597;
color:white;
padding:12px 16px;
display:flex;
justify-content:space-between;
align-items:center;
}
#chat{
flex:1;
overflow-y:auto;
padding:15px;
display:flex;
flex-direction:column;
gap:15px;
}
.message{
display:flex;
gap:8px;
}
.message.user{
justify-content:flex-end;
}
.avatar{
width:28px;
height:28px;
border-radius:50%;
background:#2f5597;
color:white;
display:flex;
align-items:center;
justify-content:center;
font-size:11px;
}
.bubble{
background:white;
padding:12px;
border-radius:14px;
max-width:75%;
}
.message.user .bubble{
background:#2f5597;
color:white;
}
#inputArea{
display:flex;
padding:10px;
background:white;
border-top:1px solid #ddd;
gap:5px;
}
#input{
flex:1;
padding:8px;
border-radius:20px;
border:1px solid #ccc;
}
#send{
padding:8px 14px;
background:#2f5597;
color:white;
border:none;
border-radius:20px;
}
button.reset{
background:#c0392b;
color:white;
border:none;
padding:6px 10px;
border-radius:6px;
cursor:pointer;
}
</style>
</head>

<body>

<header>
<span>Turistički informator – Valpovo</span>
<button class="reset" onclick="resetChat()">Novi razgovor</button>
</header>

<div id="chat"></div>

<div id="inputArea">
<input id="input" placeholder="Postavite pitanje...">
<button id="send">Pošalji</button>
</div>

<script>

const chat = document.getElementById("chat");
const input = document.getElementById("input");
const sendBtn = document.getElementById("send");

function scrollToBottom(){
chat.scrollTop = chat.scrollHeight;
}

function addMessage(text, role="ai"){
const wrapper = document.createElement("div");
wrapper.className = role === "user" ? "message user" : "message";
wrapper.innerHTML = `
${role === "ai" ? `<div class="avatar">AI</div>` : ""}
<div class="bubble">${text}</div>
${role === "user" ? `<div class="avatar">Vi</div>` : ""}
`;
chat.appendChild(wrapper);
scrollToBottom();
}

async function sendMessage(){
const message = input.value.trim();
if(!message) return;

addMessage(message, "user");

const response = await fetch("/api/chat", {
method:"POST",
headers:{ "Content-Type":"application/json" },
body:JSON.stringify({ message })
});

const data = await response.json();

if(data.reset){
chat.innerHTML="";
addMessage("Započnimo novi razgovor. Kako vam mogu pomoći?");
return;
}

let html = `<strong>${data.title}</strong><br><br>${data.intro}`;
if(data.recommendations && data.recommendations.length){
html += "<ul>";
data.recommendations.forEach(r=>{
html += `<li><strong>${r.name}</strong><br>${r.reason}</li>`;
});
html += "</ul>";
}
html += `<br><em>${data.followUpQuestion}</em>`;

addMessage(html);

input.value="";
}

async function resetChat(){
await fetch("/api/chat", {
method:"POST",
headers:{ "Content-Type":"application/json" },
body:JSON.stringify({ message: "__RESET__" })
});
chat.innerHTML="";
addMessage("Započnimo novi razgovor. Kako vam mogu pomoći?");
}

sendBtn.addEventListener("click", sendMessage);
input.addEventListener("keypress", e=>{
if(e.key==="Enter") sendMessage();
});

addMessage("Dobrodošli! Kako vam mogu pomoći?");

</script>

</body>
</html>
