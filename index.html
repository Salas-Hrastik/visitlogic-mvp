<!DOCTYPE html>
<html lang="hr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Turistički informator Valpovo</title>

<style>
body{
    margin:0;
    font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;
    background:#eef2f7;
    display:flex;
    flex-direction:column;
    height:100vh;
}

header{
    background:linear-gradient(135deg,#2f5597,#3f6fb6);
    color:white;
    padding:22px 40px;
    display:flex;
    align-items:center;
    gap:20px;
}

header h1{
    margin:0;
    font-size:22px;
}

#chat{
    flex:1;
    overflow-y:auto;
    padding:30px 40px;
    display:flex;
    flex-direction:column;
    gap:20px;
}

.message{
    display:flex;
    gap:12px;
}

.avatar{
    width:40px;
    height:40px;
    border-radius:50%;
    background:#2f5597;
    color:white;
    display:flex;
    align-items:center;
    justify-content:center;
    font-weight:600;
    flex-shrink:0;
}

.bubble{
    background:white;
    padding:20px;
    border-radius:12px;
    box-shadow:0 4px 14px rgba(0,0,0,0.08);
    max-width:800px;
    width:100%;
}

#inputArea{
    background:white;
    padding:16px 30px;
    border-top:1px solid #ddd;
    display:flex;
    gap:10px;
}

#input{
    flex:1;
    padding:12px;
    border-radius:8px;
    border:1px solid #cfd6e4;
    font-size:15px;
}

#send{
    padding:12px 24px;
    background:#2f5597;
    color:white;
    border:none;
    border-radius:8px;
    cursor:pointer;
}
</style>
</head>

<body>

<header>
<h1>Turistički informator – Grad Valpovo</h1>
</header>

<div id="chat"></div>

<div id="inputArea">
<input id="input" placeholder="Postavite pitanje...">
<button id="send" onclick="sendMessage()">Pošalji</button>
</div>

<script>

const chat = document.getElementById("chat");
let chatHistory = [];

function addMessage(html){
    const wrapper = document.createElement("div");
    wrapper.className="message";

    wrapper.innerHTML = `
        <div class="avatar">AI</div>
        <div class="bubble">${html}</div>
    `;

    chat.appendChild(wrapper);
    chat.scrollTop = chat.scrollHeight;
}

function renderStructuredResponse(data){

    let html = `<h2>${data.title}</h2>`;
    html += `<p>${data.intro}</p>`;

    data.sections.forEach(section => {
        html += `<h3>${section.heading}</h3><ul>`;

        section.items.forEach(item => {
            html += `
                <li>
                    <strong>${item.name}</strong><br>
                    ${item.description}<br>
                    <a href="${item.link}" target="_blank">Više informacija</a>
                </li>
            `;
        });

        html += `</ul>`;
    });

    addMessage(html);
}

async function sendMessage(){

    const input = document.getElementById("input");
    const message = input.value.trim();

    if(message === "") return;

    addMessage(`<strong>Vi:</strong> ${message}`);
    addMessage("<em>Razmišljam...</em>");

    try {

        const response = await fetch("/api/chat", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                message,
                history: chatHistory.slice(-6)
            })
        });

        const data = await response.json();

        chatHistory.push({ role: "user", content: message });
        chatHistory.push({ role: "assistant", content: JSON.stringify(data) });

        renderStructuredResponse(data);

    } catch(error){
        addMessage("Došlo je do pogreške.");
    }

    input.value="";
}

document.getElementById("input").addEventListener("keypress", function(e){
    if(e.key === "Enter"){
        sendMessage();
    }
});

</script>

</body>
</html>
