<!DOCTYPE html>
<html lang="hr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Turistički informator Valpovo</title>

<style>
body{
    margin:0;
    font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;
    background:#eef2f7;
    display:flex;
    flex-direction:column;
    height:100vh;
}

header{
    background:linear-gradient(135deg,#2f5597,#3f6fb6);
    color:white;
    padding:22px 40px;
    display:flex;
    align-items:center;
    gap:20px;
}

header img{
    height:60px;
}

header h1{
    margin:0;
    font-size:24px;
    font-weight:600;
}

header p{
    margin:4px 0 0 0;
    font-size:14px;
    opacity:.9;
}

#chat{
    flex:1;
    overflow-y:auto;
    padding:40px 60px;
    display:flex;
    flex-direction:column; /* NORMALNO */
    gap:28px;
}

.message{
    display:flex;
    gap:18px;
}

.avatar{
    width:42px;
    height:42px;
    border-radius:50%;
    background:#2f5597;
    color:white;
    display:flex;
    align-items:center;
    justify-content:center;
    font-weight:600;
    flex-shrink:0;
}

.bubble{
    background:white;
    padding:28px 34px;
    border-radius:14px;
    box-shadow:0 6px 18px rgba(0,0,0,0.08);
    width:100%;
    max-width:800px;
}

.bubble h2{
    margin-top:0;
    color:#2f5597;
}

.quickButtons{
    display:flex;
    gap:16px;
    margin-top:20px;
    flex-wrap:wrap;
}

.quickButtons button{
    background:#e1e8f6;
    border:none;
    padding:10px 18px;
    border-radius:24px;
    cursor:pointer;
    font-weight:500;
}

.quickButtons button:hover{
    background:#cdd9ee;
}

#inputArea{
    background:white;
    padding:18px 40px;
    border-top:1px solid #ddd;
    display:flex;
    gap:14px;
}

#input{
    flex:1;
    padding:14px;
    border-radius:8px;
    border:1px solid #cfd6e4;
    font-size:15px;
}

#send{
    padding:14px 28px;
    background:#2f5597;
    color:white;
    border:none;
    border-radius:8px;
    cursor:pointer;
}

footer{
    text-align:center;
    font-size:13px;
    padding:10px;
    background:#f4f6fa;
}
</style>
</head>

<body>

<header>
<img src="tz-logo-Valpovo.png" alt="Logo Turističke zajednice Valpovo">
<div>
<h1>Turistički informator</h1>
<p>Turistička zajednica grada Valpova</p>
</div>
</header>

<div id="chat">

<div class="message">
<div class="avatar">AI</div>
<div class="bubble">
<strong>Dobrodošli!</strong><br><br>
Postavite pitanje ili odaberite opciju:
<div class="quickButtons">
<button onclick="quickAsk('Što vrijedi vidjeti u Valpovu?')">Znamenitosti</button>
<button onclick="quickAsk('Gdje mogu jesti u Valpovu?')">Gastronomija</button>
<button onclick="quickAsk('Koja su aktualna događanja?')">Događanja</button>
</div>
</div>
</div>

</div>

<div id="inputArea">
<input id="input" placeholder="Postavite pitanje...">
<button id="send" onclick="sendMessage()">Pošalji</button>
</div>

<footer>
© Turistička zajednica grada Valpova – Digitalni informator
</footer>

<script>

const chat = document.getElementById("chat");
let chatHistory = [];

function scrollToBottom(){
    chat.scrollTop = chat.scrollHeight;
}

function addMessage(html){
    const wrapper = document.createElement("div");
    wrapper.className="message";

    wrapper.innerHTML = `
        <div class="avatar">AI</div>
        <div class="bubble">${html}</div>
    `;

    chat.appendChild(wrapper);
    scrollToBottom(); /* KLJUČNO */
}

function renderStructuredResponse(data){

    let html = `<h2>${data.title}</h2>`;
    html += `<p>${data.intro}</p>`;

    data.sections.forEach(section => {
        html += `<h3>${section.heading}</h3><ul>`;

        section.items.forEach(item => {
            html += `
                <li>
                    <strong>${item.name}</strong><br>
                    ${item.description}<br>
                    <a href="${item.link}" target="_blank">Više informacija</a>
                </li>
            `;
        });

        html += `</ul>`;
    });

    addMessage(html);
}

async function sendMessage(){

    const input = document.getElementById("input");
    const message = input.value.trim();

    if(message === "") return;

    addMessage(`<strong>Vi:</strong> ${message}`);
    addMessage("<em>Razmišljam...</em>");

    try {

        const response = await fetch("/api/chat", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                message,
                history: chatHistory.slice(-6)
            })
        });

        const data = await response.json();

        chatHistory.push({ role: "user", content: message });
        chatHistory.push({ role: "assistant", content: JSON.stringify(data) });

        renderStructuredResponse(data);

    } catch(error){
        addMessage("Došlo je do pogreške.");
    }

    input.value="";
}

function quickAsk(text){
    document.getElementById("input").value = text;
    sendMessage();
}

document.getElementById("input").addEventListener("keypress", function(e){
    if(e.key === "Enter"){
        sendMessage();
    }
});

window.onload = scrollToBottom;

</script>

</body>
</html>
